(()=>{var e={};e.id=992,e.ids=[992],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11516:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(82614).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},14283:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(82614).A)("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]])},18980:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>c,pages:()=>u,routeModule:()=>p,tree:()=>d});var s=r(65239),a=r(48088),i=r(88170),n=r.n(i),o=r(30893),l={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let d={children:["",{children:["online",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,93684)),"/home/user/studio/src/app/online/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,94431)),"/home/user/studio/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,u=["/home/user/studio/src/app/online/page.tsx"],c={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/online/page",pathname:"/online",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},19771:e=>{"use strict";e.exports=require("process")},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28087:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>y});var s=r(60687),a=r(43210),i=r(16189),n=r(18780),o=r(29523),l=r(89667),d=r(44493),u=r(11516),c=r(82614);let p=(0,c.A)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),h=(0,c.A)("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);var m=r(14283);let f=(0,c.A)("VenetianMask",[["path",{d:"M18 11c-1.5 0-2.5.5-3 2",key:"1fod00"}],["path",{d:"M4 6a2 2 0 0 0-2 2v4a5 5 0 0 0 5 5 8 8 0 0 1 5 2 8 8 0 0 1 5-2 5 5 0 0 0 5-5V8a2 2 0 0 0-2-2h-3a8 8 0 0 0-5 2 8 8 0 0 0-5-2z",key:"d70hit"}],["path",{d:"M6 11c1.5 0 2.5.5 3 2",key:"136fht"}]]);var x=r(29867),g=r(74742);function y(){let{user:e,loading:t}=(0,n.A)(),r=(0,i.useRouter)(),{toast:c}=(0,x.dj)(),[y,b]=(0,a.useState)(""),[v,w]=(0,a.useState)(null),j=async t=>{if(!e)return void c({title:"Please log in",description:"You must be logged in to create an online game.",variant:"destructive"});w("create");try{let s=await (0,g.JV)(e,t);r.push(`/online/game/${s}`)}catch(e){console.error(e),c({title:"Error",description:"Could not create game.",variant:"destructive"}),w(null)}},k=async()=>{if(!e)return void c({title:"Please log in",description:"You must be logged in to create a game.",variant:"destructive"});w("bots");try{let t=await (0,g.do)(e);r.push(`/online/game/${t}`)}catch(e){console.error(e),c({title:"Error",description:"Could not create bot game.",variant:"destructive"}),w(null)}},N=async()=>{if(!e)return void c({title:"Please log in",description:"You must be logged in to join a game.",variant:"destructive"});w("public");try{let t=await (0,g.iY)(e);r.push(`/online/game/${t}`)}catch(e){console.error(e),c({title:"Error",description:"Could not find a public game. Why not create one?",variant:"destructive"}),w(null)}};return t?(0,s.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,s.jsx)(u.A,{className:"h-12 w-12 animate-spin"})}):e?(0,s.jsx)("main",{className:"min-h-screen bg-background p-4 sm:p-8 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"w-full max-w-2xl space-y-8",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold",children:"Play Online"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Join a game or create your own."})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)(d.Zp,{children:[(0,s.jsxs)(d.aR,{children:[(0,s.jsx)(d.ZB,{children:"Create a Game"}),(0,s.jsx)(d.BT,{children:"Start a new game with friends or play against bots."})]}),(0,s.jsxs)(d.Wu,{className:"space-y-4",children:[(0,s.jsxs)(o.$,{className:"w-full",onClick:()=>j(!0),disabled:!!v,children:["create"===v?(0,s.jsx)(u.A,{className:"animate-spin"}):(0,s.jsx)(p,{}),"Create Private Game"]}),(0,s.jsxs)(o.$,{className:"w-full",variant:"secondary",onClick:()=>j(!1),disabled:!!v,children:["create"===v?(0,s.jsx)(u.A,{className:"animate-spin"}):(0,s.jsx)(h,{}),"Create Public Game"]}),(0,s.jsxs)(o.$,{className:"w-full",variant:"outline",onClick:k,disabled:!!v,children:["bots"===v?(0,s.jsx)(u.A,{className:"animate-spin"}):(0,s.jsx)(m.A,{}),"Play with Bots"]})]})]}),(0,s.jsxs)(d.Zp,{children:[(0,s.jsxs)(d.aR,{children:[(0,s.jsx)(d.ZB,{children:"Join a Game"}),(0,s.jsx)(d.BT,{children:"Get in on the action."})]}),(0,s.jsxs)(d.Wu,{className:"space-y-4",children:[(0,s.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!y.trim())return void c({title:"Invalid Code",description:"Please enter a game code.",variant:"destructive"});w("join"),r.push(`/online/game/${y.trim()}`)},className:"space-y-2",children:[(0,s.jsx)(l.p,{placeholder:"Enter game code...",value:y,onChange:e=>b(e.target.value),disabled:!!v}),(0,s.jsxs)(o.$,{type:"submit",className:"w-full",variant:"secondary",disabled:!!v,children:["join"===v?(0,s.jsx)(u.A,{className:"animate-spin"}):null,"Join with Code"]})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,s.jsx)("span",{className:"w-full border-t"})}),(0,s.jsx)("div",{className:"relative flex justify-center text-xs uppercase",children:(0,s.jsx)("span",{className:"bg-card px-2 text-muted-foreground",children:"Or"})})]}),(0,s.jsxs)(o.$,{className:"w-full",variant:"outline",onClick:N,disabled:!!v,children:["public"===v?(0,s.jsx)(u.A,{className:"animate-spin"}):(0,s.jsx)(f,{}),"Find a Public Game"]})]})]})]})]})}):(0,s.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,s.jsxs)(d.Zp,{className:"w-full max-w-md",children:[(0,s.jsxs)(d.aR,{children:[(0,s.jsx)(d.ZB,{children:"Authentication Required"}),(0,s.jsx)(d.BT,{children:"You need to be logged in to play online."})]}),(0,s.jsx)(d.Wu,{children:(0,s.jsx)(o.$,{className:"w-full",onClick:()=>r.push("/login"),children:"Go to Login"})})]})})}},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},37366:e=>{"use strict";e.exports=require("dns")},47367:(e,t,r)=>{Promise.resolve().then(r.bind(r,93684))},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73496:e=>{"use strict";e.exports=require("http2")},74075:e=>{"use strict";e.exports=require("zlib")},74742:(e,t,r)=>{"use strict";r.d(t,{JV:()=>o,bD:()=>h,do:()=>l,fC:()=>c,iY:()=>d,z5:()=>p});var s=r(33784),a=r(75535);let i=()=>{let e=["2","3","4","5","6","7","8","9","10","J","Q","K","A"],t=[],r={spades:4,hearts:3,diamonds:2,clubs:1};return["spades","hearts","diamonds","clubs"].forEach(s=>{e.forEach((e,a)=>{t.push({suit:s,rank:e,value:a+2,suitValue:r[s]})})}),t},n=e=>{for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e};async function o(e,t){let r=(0,a.H9)((0,a.rJ)(s.db,"games")),i={uid:e.uid,name:e.displayName||"Anonymous",photoURL:e.photoURL,isBot:!1,seat:0,score:0,tricksWon:0},n={id:r.id,hostId:e.uid,status:"waiting",players:[i],settings:{isPrivate:t,winningScore:50},currentRound:1,currentTrick:1,currentTurnSeat:0,trickSuit:null,cardsOnTable:[],calls:{}};if(await (0,a.BN)(r,n),!t){let e=(0,a.H9)(s.db,"lobby",r.id);await (0,a.BN)(e,{gameId:r.id,playerCount:1})}return r.id}async function l(e){let t=(0,a.H9)((0,a.rJ)(s.db,"games")),r=(0,a.wP)(s.db),o=[{uid:e.uid,name:e.displayName||`Guest ${Math.floor(1e3*Math.random())}`,photoURL:e.photoURL,isBot:!1,seat:0,score:0,tricksWon:0},{uid:"bot-1",name:"Bot Alpha",photoURL:null,isBot:!0,seat:1,score:0,tricksWon:0},{uid:"bot-2",name:"Bot Bravo",photoURL:null,isBot:!0,seat:2,score:0,tricksWon:0},{uid:"bot-3",name:"Bot Charlie",photoURL:null,isBot:!0,seat:3,score:0,tricksWon:0}],l=n(i()),d={};o.forEach(e=>{d[e.uid]=[]});for(let e=0;e<52;e++){let t=e%4;d[o.find(e=>e.seat===t).uid].push(l[e])}for(let e of o){let i=(0,a.H9)(s.db,"games",t.id,"private",e.uid),n=d[e.uid].sort((e,t)=>e.suitValue!==t.suitValue?t.suitValue-e.suitValue:t.value-e.value);r.set(i,{hand:n})}let u={id:t.id,hostId:e.uid,status:"playing",players:o,settings:{isPrivate:!0,winningScore:50},currentRound:1,currentTrick:1,currentTurnSeat:0,trickSuit:null,cardsOnTable:[],calls:{}};return r.set(t,u),await r.commit(),t.id}async function d(e){let t=(0,a.P)((0,a.rJ)(s.db,"lobby"),(0,a._M)("playerCount","<",4),(0,a.AB)(1)),r=await (0,a.GG)(t);if(r.empty)return o(e,!1);{let t=r.docs[0].id;return await u(t,e),t}}async function u(e,t){let r=(0,a.H9)(s.db,"games",e);try{await (0,a.c4)(s.db,async i=>{let n=await i.get(r);if(!n.exists())throw Error("Game not found!");let o=n.data();if(o.players.some(e=>e.uid===t.uid))return;if(o.players.length>=4)throw Error("Game is full!");if("waiting"!==o.status)throw Error("Game has already started!");let l={uid:t.uid,name:t.displayName||"Anonymous",photoURL:t.photoURL,isBot:!1,seat:o.players.length,score:0,tricksWon:0};if(i.update(r,{players:(0,a.hq)(l)}),!o.settings.isPrivate){let t=(0,a.H9)(s.db,"lobby",e);i.update(t,{playerCount:o.players.length+1})}})}catch(e){throw console.error("Failed to join game:",e),e}}async function c(e,t){let r=(0,a.H9)(s.db,"games",e),o=await (0,a.x7)(r);if(!o.exists())throw Error("Game not found");let l=o.data();if(l.hostId!==t)throw Error("Only the host can start the game.");if(4!==l.players.length)throw Error("Need 4 players to start.");if("waiting"!==l.status)throw Error("Game has already started.");let d=n(i()),u={};l.players.forEach(e=>{u[e.uid]=[]});for(let e=0;e<52;e++){let t=e%4;u[l.players.find(e=>e.seat===t).uid].push(d[e])}let c=(0,a.wP)(s.db);for(let t of l.players){let r=(0,a.H9)(s.db,"games",e,"private",t.uid),i=u[t.uid].sort((e,t)=>e.suitValue!==t.suitValue?t.suitValue-e.suitValue:t.value-e.value);c.set(r,{hand:i})}if(c.update(r,{status:"playing",currentTurnSeat:0}),!l.settings.isPrivate){let t=(0,a.H9)(s.db,"lobby",e);c.delete(t)}await c.commit()}async function p(e,t,r){let i=(0,a.H9)(s.db,"games",e),n=(0,a.H9)(s.db,"games",e,"private",t);await (0,a.c4)(s.db,async e=>{let s=await e.get(i),a=await e.get(n);if(!s.exists()||!a.exists())throw Error("Game or player hand not found.");let o=s.data(),l=o.players.find(e=>e.uid===t),d=a.data()?.hand;if(!l)throw Error("Player not found in this game.");if("playing"!==o.status)throw Error("Not in playing phase.");if(o.currentTurnSeat!==l.seat)throw Error("Not your turn.");if(!d.some(e=>e.rank===r.rank&&e.suit===r.suit))throw Error("Card not in hand.");if(o.trickSuit&&d.some(e=>e.suit===o.trickSuit)&&r.suit!==o.trickSuit)throw Error("Must follow suit if you can.");let u=d.filter(e=>e.rank!==r.rank||e.suit!==r.suit);e.update(n,{hand:u});let c={seat:l.seat,card:r},p=[...o.cardsOnTable,c],h={cardsOnTable:p,currentTurnSeat:(o.currentTurnSeat+1)%4,trickSuit:o.trickSuit||r.suit};if(4===p.length){let e,t=p.filter(e=>"spades"===e.card.suit);e=t.length>0?t.sort((e,t)=>t.card.value-e.card.value)[0]:p.filter(e=>e.card.suit===h.trickSuit).sort((e,t)=>t.card.value-e.card.value)[0];let r=o.players.find(t=>t.seat===e.seat);h.status="trick_scoring",h.lastTrickWinnerSeat=r.seat,h.currentTurnSeat=r.seat,h.players=o.players.map(e=>e.uid===r.uid?{...e,tricksWon:e.tricksWon+1}:e)}e.update(i,h)})}async function h(e){let t=(0,a.H9)(s.db,"games",e);await (0,a.c4)(s.db,async e=>{let r=await e.get(t);if(!r.exists())throw Error("Game not found.");let s=r.data();if("trick_scoring"!==s.status)return;let a={status:"playing",cardsOnTable:[],trickSuit:null,currentTrick:s.currentTrick+1};a.currentTrick>13&&(a.status="round_scoring"),e.update(t,a)})}},77631:(e,t,r)=>{Promise.resolve().then(r.bind(r,28087))},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},89667:(e,t,r)=>{"use strict";r.d(t,{p:()=>n});var s=r(60687),a=r(43210),i=r(4780);let n=a.forwardRef(({className:e,type:t,...r},a)=>(0,s.jsx)("input",{type:t,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:a,...r}));n.displayName="Input"},91645:e=>{"use strict";e.exports=require("net")},93684:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/user/studio/src/app/online/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/user/studio/src/app/online/page.tsx","default")},94735:e=>{"use strict";e.exports=require("events")}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,803,95,776],()=>r(18980));module.exports=s})();