"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7],{285:(t,e,r)=>{r.d(e,{$:()=>d});var a=r(5155),s=r(2115),i=r(4253),o=r(2085),n=r(9434);let u=(0,o.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef((t,e)=>{let{className:r,variant:s,size:o,asChild:d=!1,...l}=t,c=d?i.DX:"button";return(0,a.jsx)(c,{className:(0,n.cn)(u({variant:s,size:o,className:r})),ref:e,...l})});d.displayName="Button"},2250:(t,e,r)=>{r.d(e,{JV:()=>n,bD:()=>f,do:()=>u,fC:()=>c,iY:()=>d,z5:()=>p});var a=r(6104),s=r(5317);let i=()=>{let t=["2","3","4","5","6","7","8","9","10","J","Q","K","A"],e=[],r={spades:4,hearts:3,diamonds:2,clubs:1};return["spades","hearts","diamonds","clubs"].forEach(a=>{t.forEach((t,s)=>{e.push({suit:a,rank:t,value:s+2,suitValue:r[a]})})}),e},o=t=>{for(let e=t.length-1;e>0;e--){let r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}return t};async function n(t,e){let r=(0,s.H9)((0,s.rJ)(a.db,"games")),i={uid:t.uid,name:t.displayName||"Anonymous",photoURL:t.photoURL,isBot:!1,seat:0,score:0,tricksWon:0},o={id:r.id,hostId:t.uid,status:"waiting",players:[i],settings:{isPrivate:e,winningScore:50},currentRound:1,currentTrick:1,currentTurnSeat:0,trickSuit:null,cardsOnTable:[],calls:{}};if(await (0,s.BN)(r,o),!e){let t=(0,s.H9)(a.db,"lobby",r.id);await (0,s.BN)(t,{gameId:r.id,playerCount:1})}return r.id}async function u(t){let e=(0,s.H9)((0,s.rJ)(a.db,"games")),r=(0,s.wP)(a.db),n=[{uid:t.uid,name:t.displayName||"Guest ".concat(Math.floor(1e3*Math.random())),photoURL:t.photoURL,isBot:!1,seat:0,score:0,tricksWon:0},{uid:"bot-1",name:"Bot Alpha",photoURL:null,isBot:!0,seat:1,score:0,tricksWon:0},{uid:"bot-2",name:"Bot Bravo",photoURL:null,isBot:!0,seat:2,score:0,tricksWon:0},{uid:"bot-3",name:"Bot Charlie",photoURL:null,isBot:!0,seat:3,score:0,tricksWon:0}],u=o(i()),d={};n.forEach(t=>{d[t.uid]=[]});for(let t=0;t<52;t++){let e=t%4;d[n.find(t=>t.seat===e).uid].push(u[t])}for(let t of n){let i=(0,s.H9)(a.db,"games",e.id,"private",t.uid),o=d[t.uid].sort((t,e)=>t.suitValue!==e.suitValue?e.suitValue-t.suitValue:e.value-t.value);r.set(i,{hand:o})}let l={id:e.id,hostId:t.uid,status:"playing",players:n,settings:{isPrivate:!0,winningScore:50},currentRound:1,currentTrick:1,currentTurnSeat:0,trickSuit:null,cardsOnTable:[],calls:{}};return r.set(e,l),await r.commit(),e.id}async function d(t){let e=(0,s.P)((0,s.rJ)(a.db,"lobby"),(0,s._M)("playerCount","<",4),(0,s.AB)(1)),r=await (0,s.GG)(e);if(r.empty)return n(t,!1);{let e=r.docs[0].id;return await l(e,t),e}}async function l(t,e){let r=(0,s.H9)(a.db,"games",t);try{await (0,s.c4)(a.db,async i=>{let o=await i.get(r);if(!o.exists())throw Error("Game not found!");let n=o.data();if(n.players.some(t=>t.uid===e.uid))return;if(n.players.length>=4)throw Error("Game is full!");if("waiting"!==n.status)throw Error("Game has already started!");let u={uid:e.uid,name:e.displayName||"Anonymous",photoURL:e.photoURL,isBot:!1,seat:n.players.length,score:0,tricksWon:0};if(i.update(r,{players:(0,s.hq)(u)}),!n.settings.isPrivate){let e=(0,s.H9)(a.db,"lobby",t);i.update(e,{playerCount:n.players.length+1})}})}catch(t){throw console.error("Failed to join game:",t),t}}async function c(t,e){let r=(0,s.H9)(a.db,"games",t),n=await (0,s.x7)(r);if(!n.exists())throw Error("Game not found");let u=n.data();if(u.hostId!==e)throw Error("Only the host can start the game.");if(4!==u.players.length)throw Error("Need 4 players to start.");if("waiting"!==u.status)throw Error("Game has already started.");let d=o(i()),l={};u.players.forEach(t=>{l[t.uid]=[]});for(let t=0;t<52;t++){let e=t%4;l[u.players.find(t=>t.seat===e).uid].push(d[t])}let c=(0,s.wP)(a.db);for(let e of u.players){let r=(0,s.H9)(a.db,"games",t,"private",e.uid),i=l[e.uid].sort((t,e)=>t.suitValue!==e.suitValue?e.suitValue-t.suitValue:e.value-t.value);c.set(r,{hand:i})}if(c.update(r,{status:"playing",currentTurnSeat:0}),!u.settings.isPrivate){let e=(0,s.H9)(a.db,"lobby",t);c.delete(e)}await c.commit()}async function p(t,e,r){let i=(0,s.H9)(a.db,"games",t),o=(0,s.H9)(a.db,"games",t,"private",e);await (0,s.c4)(a.db,async t=>{var a;let s=await t.get(i),n=await t.get(o);if(!s.exists()||!n.exists())throw Error("Game or player hand not found.");let u=s.data(),d=u.players.find(t=>t.uid===e),l=null==(a=n.data())?void 0:a.hand;if(!d)throw Error("Player not found in this game.");if("playing"!==u.status)throw Error("Not in playing phase.");if(u.currentTurnSeat!==d.seat)throw Error("Not your turn.");if(!l.some(t=>t.rank===r.rank&&t.suit===r.suit))throw Error("Card not in hand.");if(u.trickSuit&&l.some(t=>t.suit===u.trickSuit)&&r.suit!==u.trickSuit)throw Error("Must follow suit if you can.");let c=l.filter(t=>t.rank!==r.rank||t.suit!==r.suit);t.update(o,{hand:c});let p={seat:d.seat,card:r},f=[...u.cardsOnTable,p],h={cardsOnTable:f,currentTurnSeat:(u.currentTurnSeat+1)%4,trickSuit:u.trickSuit||r.suit};if(4===f.length){let t,e=f.filter(t=>"spades"===t.card.suit);t=e.length>0?e.sort((t,e)=>e.card.value-t.card.value)[0]:f.filter(t=>t.card.suit===h.trickSuit).sort((t,e)=>e.card.value-t.card.value)[0];let r=u.players.find(e=>e.seat===t.seat);h.status="trick_scoring",h.lastTrickWinnerSeat=r.seat,h.currentTurnSeat=r.seat,h.players=u.players.map(t=>t.uid===r.uid?{...t,tricksWon:t.tricksWon+1}:t)}t.update(i,h)})}async function f(t){let e=(0,s.H9)(a.db,"games",t);await (0,s.c4)(a.db,async t=>{let r=await t.get(e);if(!r.exists())throw Error("Game not found.");let a=r.data();if("trick_scoring"!==a.status)return;let s={status:"playing",cardsOnTable:[],trickSuit:null,currentTrick:a.currentTrick+1};s.currentTrick>13&&(s.status="round_scoring"),t.update(e,s)})}},4744:(t,e,r)=>{r.d(e,{Fz:()=>n,VM:()=>o,Vz:()=>i,Ze:()=>u});var a=r(6104),s=r(5317);async function i(t){let e=(0,s.H9)(a.db,"users",t.uid);if((await (0,s.x7)(e)).exists())return void await (0,s.mZ)(e,{photoURL:t.photoURL});let r={uid:t.uid,email:t.email,displayName:t.displayName,photoURL:t.photoURL};await (0,s.BN)(e,r,{merge:!0})}async function o(t){let e=(0,s.H9)(a.db,"users",t),r=await (0,s.x7)(e);return r.exists()?r.data():null}async function n(t,e){let r=(0,s.rJ)(a.db,"users"),i=(0,s.P)(r,(0,s._M)("displayName","==",t),(0,s.AB)(1)),o=await (0,s.GG)(i);return!!o.empty||o.docs[0].id===e}async function u(t,e){let r=(0,s.H9)(a.db,"users",t);await (0,s.mZ)(r,e)}},6104:(t,e,r)=>{r.d(e,{db:()=>n,j:()=>u,y:()=>o});var a=r(3915),s=r(5317),i=r(3004);let o=(0,a.Dk)().length?(0,a.Sx)():(0,a.Wp)({apiKey:"AIzaSyDNFKX0y3B8M-HRqZNGjheMUgHWxX_c-6Y",authDomain:"bridgescore-app.firebaseapp.com",databaseURL:"https://bridgescore-app-default-rtdb.firebaseio.com",projectId:"bridgescore-app",storageBucket:"bridgescore-app.appspot.com",messagingSenderId:"1011165776209",appId:"1:1011165776209:web:a3d46c6f0f5c4bca59eb70",measurementId:"G-D42JPN6307"}),n=(0,s.aU)(o),u=(0,i.xI)(o)},6695:(t,e,r)=>{r.d(e,{BT:()=>d,Wu:()=>l,ZB:()=>u,Zp:()=>o,aR:()=>n,wL:()=>c});var a=r(5155),s=r(2115),i=r(9434);let o=s.forwardRef((t,e)=>{let{className:r,...s}=t;return(0,a.jsx)("div",{ref:e,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});o.displayName="Card";let n=s.forwardRef((t,e)=>{let{className:r,...s}=t;return(0,a.jsx)("div",{ref:e,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",r),...s})});n.displayName="CardHeader";let u=s.forwardRef((t,e)=>{let{className:r,...s}=t;return(0,a.jsx)("div",{ref:e,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});u.displayName="CardTitle";let d=s.forwardRef((t,e)=>{let{className:r,...s}=t;return(0,a.jsx)("div",{ref:e,className:(0,i.cn)("text-sm text-muted-foreground",r),...s})});d.displayName="CardDescription";let l=s.forwardRef((t,e)=>{let{className:r,...s}=t;return(0,a.jsx)("div",{ref:e,className:(0,i.cn)("p-6 pt-0",r),...s})});l.displayName="CardContent";let c=s.forwardRef((t,e)=>{let{className:r,...s}=t;return(0,a.jsx)("div",{ref:e,className:(0,i.cn)("flex items-center p-6 pt-0",r),...s})});c.displayName="CardFooter"},7481:(t,e,r)=>{r.d(e,{dj:()=>p});var a=r(2115);let s=0,i=new Map,o=t=>{if(i.has(t))return;let e=setTimeout(()=>{i.delete(t),l({type:"REMOVE_TOAST",toastId:t})},1e6);i.set(t,e)},n=(t,e)=>{switch(e.type){case"ADD_TOAST":return{...t,toasts:[e.toast,...t.toasts].slice(0,1)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(t=>t.id===e.toast.id?{...t,...e.toast}:t)};case"DISMISS_TOAST":{let{toastId:r}=e;return r?o(r):t.toasts.forEach(t=>{o(t.id)}),{...t,toasts:t.toasts.map(t=>t.id===r||void 0===r?{...t,open:!1}:t)}}case"REMOVE_TOAST":if(void 0===e.toastId)return{...t,toasts:[]};return{...t,toasts:t.toasts.filter(t=>t.id!==e.toastId)}}},u=[],d={toasts:[]};function l(t){d=n(d,t),u.forEach(t=>{t(d)})}function c(t){let{...e}=t,r=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>l({type:"DISMISS_TOAST",toastId:r});return l({type:"ADD_TOAST",toast:{...e,id:r,open:!0,onOpenChange:t=>{t||a()}}}),{id:r,dismiss:a,update:t=>l({type:"UPDATE_TOAST",toast:{...t,id:r}})}}function p(){let[t,e]=a.useState(d);return a.useEffect(()=>(u.push(e),()=>{let t=u.indexOf(e);t>-1&&u.splice(t,1)}),[t]),{...t,toast:c,dismiss:t=>l({type:"DISMISS_TOAST",toastId:t})}}},9434:(t,e,r)=>{r.d(e,{cn:()=>i});var a=r(2596),s=r(9688);function i(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return(0,s.QP)((0,a.$)(e))}},9576:(t,e,r)=>{r.d(e,{A:()=>f,AuthProvider:()=>p});var a=r(5155),s=r(2115),i=r(3004),o=r(6104),n=r(9563),u=r(5317),d=r(4744),l=r(5695);let c=(0,s.createContext)(void 0),p=t=>{let{children:e}=t,[r,p]=(0,s.useState)(null),[f,h]=(0,s.useState)(!0),m=(0,l.useRouter)();(0,s.useEffect)(()=>{try{(0,n.Ay)(o.y,{provider:new n._u("6LfJlHErAAAAAA_G-5_kCMD4jtLUiGrBV_WUbVnu"),isTokenAutoRefreshEnabled:!0})}catch(t){console.error("Failed to initialize App Check",t)}let t=(0,i.hg)(o.j,t=>{p(t),h(!1)});return()=>t()},[]);let y=async()=>{let t=new i.HF;try{let e=await (0,i.df)(o.j,t);await (0,d.Vz)(e.user)}catch(t){throw console.error("Error signing in with Google: ",t),t}},g=async(t,e)=>{try{let r=await (0,i.eJ)(o.j,t,e);return await (0,d.Vz)(r.user),r}catch(t){throw console.error("Error signing up with email: ",t),t}},w=async(t,e)=>{try{return await (0,i.x9)(o.j,t,e)}catch(t){throw console.error("Error logging in with email: ",t),t}},b=async()=>{await (0,i.CI)(o.j),m.push("/")},v=async()=>{try{let t=(await (0,i.zK)(o.j)).user,e=(0,u.H9)(o.db,"users",t.uid);if(!(await (0,u.x7)(e)).exists()){let r="Guest ".concat(Math.floor(1e3*Math.random()));await (0,i.r7)(t,{displayName:r}),await (0,u.BN)(e,{uid:t.uid,email:t.email,displayName:r,photoURL:t.photoURL})}return t}catch(t){throw console.error("Error signing in as guest:",t),t}},x=async t=>{if(!o.j.currentUser)return{success:!1,message:"You must be logged in to update your profile."};try{if(!await (0,d.Fz)(t,o.j.currentUser.uid))return{success:!1,message:"Username is already taken. Please choose another."};return await (0,i.r7)(o.j.currentUser,{displayName:t}),await (0,d.Ze)(o.j.currentUser.uid,{displayName:t}),p(o.j.currentUser),{success:!0,message:"Username updated successfully!"}}catch(t){return console.error("Error updating username: ",t),{success:!1,message:t instanceof Error?t.message:"An unknown error occurred."}}};return(0,a.jsx)(c.Provider,{value:{user:r,loading:f,signInWithGoogle:y,logout:b,signUpWithEmail:g,loginWithEmail:w,updateUsername:x,signInAsGuest:v},children:e})},f=()=>{let t=(0,s.useContext)(c);if(void 0===t)throw Error("useAuth must be used within an AuthProvider");return t}}}]);