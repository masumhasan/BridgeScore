(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[981],{1394:(e,t,s)=>{"use strict";s.d(t,{BK:()=>c,eu:()=>i,q5:()=>o});var r=s(5155),a=s(2115),l=s(5977),n=s(9434);let i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l.bL,{ref:t,className:(0,n.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...a})});i.displayName=l.bL.displayName;let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l._V,{ref:t,className:(0,n.cn)("aspect-square h-full w-full",s),...a})});c.displayName=l._V.displayName;let o=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l.H4,{ref:t,className:(0,n.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...a})});o.displayName=l.H4.displayName},3064:(e,t,s)=>{Promise.resolve().then(s.bind(s,4839))},4839:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>U});var r=s(5155),a=s(5695),l=s(9576),n=s(2115),i=s(5317),c=s(6104);let o=e=>{let[t,s]=(0,n.useState)(null),[r,a]=(0,n.useState)(!0),[l,o]=(0,n.useState)(null);return(0,n.useEffect)(()=>{if(!e)return void a(!1);let t=(0,i.H9)(c.db,"games",e),r=(0,i.aQ)(t,async e=>{e.exists()?(s({id:e.id,...e.data()}),o(null)):(o("Game not found. Check the code and try again."),s(null)),a(!1)},e=>{console.error("Error listening to game document:",e),o("Failed to connect to the game."),a(!1)});return()=>r()},[e]),{game:t,loading:r,error:l}};var d=s(285),x=s(6695),u=s(1394),m=s(3503),f=s(518),h=s(5599),j=s(172),g=s(7481),p=s(2250);let y=e=>{var t;let{player:s}=e;return(0,r.jsx)("div",{className:"flex flex-col items-center gap-2 p-4 border rounded-lg bg-secondary/50 h-32 justify-center",children:s?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)(u.eu,{children:[(0,r.jsx)(u.BK,{src:null!=(t=s.photoURL)?t:""}),(0,r.jsx)(u.q5,{children:s.name.charAt(0).toUpperCase()})]}),s.isBot&&(0,r.jsx)(m.A,{className:"absolute -bottom-1 -right-1 h-5 w-5 bg-card text-card-foreground rounded-full p-0.5 border"})]}),(0,r.jsx)("span",{className:"font-medium text-center truncate w-full",children:s.name})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.eu,{children:(0,r.jsx)(u.q5,{children:"?"})}),(0,r.jsx)("span",{className:"text-muted-foreground",children:"Waiting..."})]})})};function b(e){let{game:t,currentUser:s}=e,{toast:a}=(0,g.dj)(),[l,i]=(0,n.useState)(!1),[c,o]=(0,n.useState)(!1),u=t.hostId===s.uid,m=u&&4===t.players.length,b=async()=>{if(m){o(!0);try{await (0,p.fC)(t.id,s.uid)}catch(e){console.error(e),a({title:"Error starting game",description:e instanceof Error?e.message:"An unknown error occurred.",variant:"destructive"}),o(!1)}}};return(0,r.jsx)("main",{className:"min-h-screen bg-background p-4 sm:p-8 flex items-center justify-center",children:(0,r.jsxs)(x.Zp,{className:"w-full max-w-3xl",children:[(0,r.jsxs)(x.aR,{className:"text-center",children:[(0,r.jsx)(x.ZB,{className:"text-3xl",children:"Game Lobby"}),(0,r.jsx)(x.BT,{children:t.settings.isPrivate?"Waiting for players to join your private game.":"Waiting for players to join this public game."})]}),(0,r.jsxs)(x.Wu,{className:"space-y-6",children:[t.settings.isPrivate&&(0,r.jsxs)("div",{className:"p-4 border-dashed border-2 rounded-lg flex flex-col sm:flex-row items-center justify-center gap-4",children:[(0,r.jsxs)("div",{className:"text-center sm:text-left",children:[(0,r.jsx)("p",{className:"text-sm font-semibold text-muted-foreground",children:"INVITE CODE"}),(0,r.jsx)("p",{className:"text-2xl font-mono break-all",children:t.id})]}),(0,r.jsx)(d.$,{variant:"outline",size:"icon",onClick:()=>{navigator.clipboard.writeText(t.id),i(!0),a({title:"Copied!",description:"Game code copied to clipboard."}),setTimeout(()=>i(!1),2e3)},children:l?(0,r.jsx)(f.A,{className:"text-green-500"}):(0,r.jsx)(h.A,{})})]}),(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Array.from({length:4}).map((e,s)=>(0,r.jsx)(y,{player:t.players.find(e=>e.seat===s)},s))}),(0,r.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,r.jsxs)("p",{children:[t.players.length," / 4 players have joined."]}),t.players.length<4&&(0,r.jsx)("p",{children:"Waiting for more players to start..."})]}),u&&(0,r.jsx)("div",{className:"flex justify-center pt-4",children:(0,r.jsxs)(d.$,{size:"lg",disabled:!m||c,onClick:b,className:"bg-accent hover:bg-accent/90 text-accent-foreground",children:[c&&(0,r.jsx)(j.A,{className:"mr-2 animate-spin"}),m?"Start Game":"Waiting for 4 players"]})})]})]})})}let N=(e,t)=>{let[s,r]=(0,n.useState)([]),[a,l]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{if(!e||!t){r([]),l(!1);return}let s=(0,i.H9)(c.db,"games",e,"private",t),a=(0,i.aQ)(s,e=>{e.exists()?r(e.data().hand||[]):r([]),l(!1)},e=>{console.error("Error listening to player hand:",e),l(!1)});return()=>a()},[e,t]),{hand:s,loading:a}};var v=s(1978),w=s(9434);let k={spades:{symbol:"♠",color:"bg-slate-800 text-white"},hearts:{symbol:"♥",color:"bg-rose-500 text-white"},diamonds:{symbol:"♦",color:"bg-amber-400 text-slate-900"},clubs:{symbol:"♣",color:"bg-teal-500 text-white"}};function S(e){let{card:t,isFaceUp:s,isPlayable:a,onClick:l,layoutId:n}=e;if(!s)return(0,r.jsx)(v.P.div,{layoutId:n,className:"h-36 w-24 rounded-lg bg-white border-2 border-gray-200 shadow-lg flex items-center justify-center p-1",children:(0,r.jsx)("div",{className:"h-full w-full rounded-md bg-slate-800 flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-4xl text-amber-400",children:"?"})})});if(!t)return null;let i=k[t.suit],c=t.rank.length>2?t.rank.charAt(0):t.rank;return(0,r.jsxs)(v.P.div,{layoutId:n,onClick:l,className:(0,w.cn)("h-36 w-24 rounded-lg p-2 flex flex-col justify-between relative shadow-lg border-2 border-black/10",i.color,a&&"ring-4 ring-yellow-400 ring-offset-2 ring-offset-background dark:ring-offset-gray-900",l&&"cursor-pointer"),children:[(0,r.jsxs)("div",{className:"flex flex-col items-start leading-none font-bold",children:[(0,r.jsx)("div",{className:"text-2xl",children:c}),(0,r.jsx)("div",{className:"text-xl -mt-1",children:i.symbol})]}),(0,r.jsx)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-5xl opacity-50",children:i.symbol}),(0,r.jsxs)("div",{className:"flex flex-col items-end leading-none font-bold rotate-180",children:[(0,r.jsx)("div",{className:"text-2xl",children:c}),(0,r.jsx)("div",{className:"text-xl -mt-1",children:i.symbol})]})]})}let E={N:"top-4 left-1/2 -translate-x-1/2 flex-col",S:"mb-4 flex-col",E:"right-4 top-1/2 -translate-y-1/2 flex-row-reverse gap-2 text-right",W:"left-4 top-1/2 -translate-y-1/2 flex-row gap-2 text-left"},T={N:"h-12 w-12 text-base",S:"h-14 w-14 text-lg",E:"h-12 w-12 text-base",W:"h-12 w-12 text-base"};function W(e){var t;let{player:s,position:a,isCurrentTurn:l}=e;return(0,r.jsxs)("div",{className:(0,w.cn)("flex items-center justify-center gap-2 p-2 rounded-lg bg-black/10 dark:bg-black/40 text-foreground z-10","S"!==a?"absolute ".concat(E[a]):E[a]),children:[(0,r.jsxs)("div",{className:(0,w.cn)("relative transition-all duration-300",l&&"ring-4 ring-yellow-400 rounded-full"),children:[(0,r.jsxs)(u.eu,{className:(0,w.cn)("border-2 border-white",T[a]),children:[(0,r.jsx)(u.BK,{src:null!=(t=s.photoURL)?t:void 0}),(0,r.jsx)(u.q5,{children:s.name.charAt(0).toUpperCase()})]}),s.isBot&&(0,r.jsx)(m.A,{className:"absolute -bottom-1 -right-1 h-5 w-5 bg-gray-700 text-white rounded-full p-0.5"})]}),(0,r.jsxs)("div",{className:(0,w.cn)("text-center","E"===a&&"text-right","W"===a&&"text-left"),children:[(0,r.jsx)("p",{className:"font-bold text-sm",children:s.name}),(0,r.jsxs)("div",{className:(0,w.cn)("text-xs flex gap-2","N"===a||"S"===a?"flex-row justify-center":"flex-col"),children:[(0,r.jsxs)("p",{children:["Tricks: ",(0,r.jsx)("span",{className:"font-bold",children:s.tricksWon})]}),(0,r.jsxs)("p",{children:["Score: ",(0,r.jsx)("span",{className:"font-bold",children:s.score})]})]})]})]})}var C=s(760);function A(e){let{cardsOnTable:t,mySeat:s}=e,a=e=>["S","W","N","E"][(e-s+4)%4];return(0,r.jsx)("div",{className:"relative w-48 h-56",children:(0,r.jsx)(C.N,{children:t.map((e,t)=>{let{seat:s,card:l}=e,n=a(s);return(0,r.jsx)(v.P.div,{className:"absolute top-1/2 left-1/2",initial:{scale:0,opacity:0,...B(n)},animate:{scale:1,opacity:1,x:"-50%",y:"-50%",...I(n)},exit:{scale:0,opacity:0},transition:{type:"spring",stiffness:500,damping:30,delay:.1},style:{zIndex:t},children:(0,r.jsx)(S,{card:l,isFaceUp:!0})},"".concat(l.rank,"-").concat(l.suit))})})})}let B=e=>{switch(e){case"S":return{y:"200%",x:"-50%"};case"N":return{y:"-200%",x:"-50%"};case"W":return{x:"-200%",y:"-50%"};case"E":return{x:"200%",y:"-50%"};default:return{}}},I=e=>{switch(e){case"S":return{y:"20%",rotate:-5};case"N":return{y:"-20%",rotate:5};case"W":return{x:"-25%",y:"0%",rotate:-15};case"E":return{x:"25%",y:"0%",rotate:15};default:return{}}};function P(e){var t;let{game:s,currentUser:a}=e,{hand:l,loading:i}=N(s.id,a.uid),c=(0,n.useMemo)(()=>{var e;return null==(e=s.players.find(e=>e.uid===a.uid))?void 0:e.seat},[s,a.uid]);(0,n.useEffect)(()=>{if("trick_scoring"===s.status){let e=setTimeout(()=>{c===s.lastTrickWinnerSeat&&(0,p.bD)(s.id)},3e3);return()=>clearTimeout(e)}},[s.status,s.id,s.lastTrickWinnerSeat,c]);let o=(0,n.useMemo)(()=>{if(void 0===c)return{};let e={},t=["S","W","N","E"];for(let r=0;r<4;r++){let a=(c+r)%4,l=s.players.find(e=>e.seat===a);l&&(e[t[r]]=l)}return e},[s.players,c]),d=e=>{"playing"===s.status&&c===s.currentTurnSeat&&(0,p.z5)(s.id,a.uid,e).catch(e=>{console.error("Failed to play card:",e)})},x=s.currentTurnSeat===c,u=x?((e,t)=>{if(!t)return e;let s=e.filter(e=>e.suit===t);return s.length>0?s:e})(l,s.trickSuit):[];return i||void 0===c?(0,r.jsx)("div",{className:"flex h-screen w-full items-center justify-center bg-gray-100 dark:bg-gray-900",children:(0,r.jsx)(j.A,{className:"h-16 w-16 animate-spin text-primary"})}):(0,r.jsxs)("div",{className:"relative flex h-screen w-screen select-none flex-col items-center justify-center bg-gray-100 dark:bg-gray-900 p-2 sm:p-4 font-sans overflow-hidden",children:[o.N&&(0,r.jsx)(W,{player:o.N,position:"N",isCurrentTurn:s.currentTurnSeat===o.N.seat}),o.E&&(0,r.jsx)(W,{player:o.E,position:"E",isCurrentTurn:s.currentTurnSeat===o.E.seat}),o.W&&(0,r.jsx)(W,{player:o.W,position:"W",isCurrentTurn:s.currentTurnSeat===o.W.seat}),(0,r.jsx)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-[60%] z-10",children:(0,r.jsx)(A,{cardsOnTable:s.cardsOnTable,mySeat:c})}),(0,r.jsxs)("div",{className:"absolute bottom-0 left-0 w-full h-[22rem] flex flex-col items-center justify-end p-4",children:[o.S&&(0,r.jsx)(W,{player:o.S,position:"S",isCurrentTurn:s.currentTurnSeat===o.S.seat}),(0,r.jsx)("div",{className:(0,w.cn)("relative w-full h-48 flex justify-center items-end transition-all duration-300",x?"":"opacity-70 scale-95"),children:(0,r.jsx)(C.N,{children:l.map((e,t)=>{let s=l.length,a=(t-(s-1)/2)*5,n=u.some(t=>t.rank===e.rank&&t.suit===e.suit);return(0,r.jsx)(v.P.div,{className:"absolute",initial:{opacity:0,y:100},animate:{opacity:1,y:0,rotate:a,x:(t-(s-1)/2)*35,transformOrigin:"bottom center"},exit:{opacity:0,y:100,transition:{duration:.2}},transition:{delay:.05*t,type:"spring",stiffness:120,damping:12},whileHover:x&&n?{y:-25,scale:1.1,rotate:a,zIndex:100}:{},onClick:()=>x&&n&&d(e),children:(0,r.jsx)(S,{card:e,isFaceUp:!0,isPlayable:x&&n,layoutId:"".concat(e.rank,"-").concat(e.suit)})},"".concat(e.rank,"-").concat(e.suit))})})})]}),(0,r.jsx)(C.N,{children:"trick_scoring"===s.status&&(0,r.jsx)(v.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"text-white text-center p-8 bg-black/70 rounded-xl shadow-lg",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold",children:"Trick Won By"}),(0,r.jsx)("p",{className:"text-4xl font-bold mt-2 text-yellow-400",children:null==(t=s.players.find(e=>e.seat===s.lastTrickWinnerSeat))?void 0:t.name})]})})})]})}var _=s(6874),z=s.n(_);function U(){let e=(0,a.useParams)().gameId,{user:t,loading:s}=(0,l.A)(),{game:n,loading:i,error:c}=o(e);return s||i?(0,r.jsx)("div",{className:"flex h-screen w-full items-center justify-center",children:(0,r.jsx)(j.A,{className:"h-16 w-16 animate-spin"})}):t?c?(0,r.jsx)("div",{className:"flex h-screen w-full items-center justify-center text-center",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-destructive",children:"Error"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:c}),(0,r.jsx)(d.$,{asChild:!0,variant:"link",className:"mt-4",children:(0,r.jsx)(z(),{href:"/online",children:"Back to Lobby"})})]})}):n?(0,r.jsxs)("div",{children:["waiting"===n.status&&(0,r.jsx)(b,{game:n,currentUser:t}),"waiting"!==n.status&&(0,r.jsx)(P,{game:n,currentUser:t})]}):(0,r.jsxs)("div",{className:"flex h-screen w-full items-center justify-center",children:[(0,r.jsx)(j.A,{className:"h-16 w-16 animate-spin"}),(0,r.jsx)("p",{className:"ml-4",children:"Loading game..."})]}):(0,r.jsx)("div",{className:"flex h-screen w-full items-center justify-center text-center p-4",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-bold",children:"Access Denied"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"You must be logged in to view this game."}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"If you were playing as a guest, you may not be able to rejoin after leaving."}),(0,r.jsx)(d.$,{asChild:!0,variant:"link",className:"mt-4",children:(0,r.jsx)(z(),{href:"/",children:"Back to Home"})})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[611,644,271,198,649,44,7,441,684,358],()=>t(3064)),_N_E=e.O()}]);